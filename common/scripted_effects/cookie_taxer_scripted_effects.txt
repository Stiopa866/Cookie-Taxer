# purchase_upgrade = { type = x }

purchase_upgrade = {
	#custom_tooltip = $type$_upgrade_tt
	hidden_effect = {
		ROOT = {
			# Subtract cost
			subtract_longs = { ln1 = cookies ln2 = $type$_cost }
			
			# Update modifier
			based_on_var_and_plus_one_fire = { var = $type$_count functor = change_upgrade arg_1 = $type$ arg_1_name = type }

			# Change count
			change_variable = { which = $type$_count value = 1 }

			# What the fuck does this do
			set_variable = { which = $type$_count_2 which = $type$_count }
			subtract_variable = { which = $type$_count_2 value = 1 }
			
			# Update cost
			get_income_cost = yes
			get_morale_cost = yes
			get_siege_cost = yes
			get_speed_cost = yes
			get_army_size_cost = yes
			get_expansion_cost = yes

			# Update cookies loc
			get_msd = { ln = cookies mantissa = cookies_mantissa exponent = cookies_exp }
		}
	}
}

#change_upgrade = { current = int next = int+1 type = modifierprefix }

change_upgrade = {
	if = {
		limit = {
			has_country_modifier = $type$_$current$
		}
		remove_country_modifier = $type$_$current$
	}
	add_country_modifier = {
		name = $type$_$next$
		duration = -1
	}
}

# purchase_building = { type = x }

purchase_building = {
	change_variable = {
		which = num_of_$x$
		value = 1
	}
	
	based_on_var_fire = { var = num_of_$x$ functor = purchase_building_cost }
}

assign_mod_to_random_province = { #count #mod
	set_variable = { which = mc value = $count$ }
	while = {
		limit = {
			check_variable = { which = mc value = 1 }
		}
		subtract_variable = {
			which = mc
			value = 1
		}
		random_province = {
			limit = {
				AND = {
					continent = europe
					NOT = { has_province_flag = ct_modifier_applied }
					owner = { ai = yes }
				}
			}
			set_province_flag = ct_modifier_applied
			add_permanent_province_modifier = {
				name = $mod$
				duration = -1
			}
		}
	}
}

